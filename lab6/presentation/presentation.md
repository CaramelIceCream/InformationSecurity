---
## Front matter
lang: ru-RU
title: Отчет по лабораторной работе №6
author: Дерябина Мария
institute: RUDN University, Moscow, Russian Federation
date: 2021

## Formatting
mainfont: Times New Roman
romanfont: Times New Roman
sansfont: Times New Roman
monofont: Times New Roman
toc: false
slide_level: 2
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
 - '\makeatletter'
 - '\beamer@ignorenonframefalse'
 - '\makeatother'
aspectratio: 43
section-titles: true
---

## Цель работы

- Развить навыки администрирования ОС Linux. 

- Получить первое практическое знакомство с технологией SELinux.

- Проверить работу SELinux на практике совместно с веб-сервером Apache.



## Выполнение. Изучение политики и контектса SELinux

Вошла в систему и убедилась, что
SELinux работает в режиме enforcing политики targeted.
Запустила веб-сервер Apache.
Нашла веб-сервер в списке процессов. Его контекст безопасности - "system_u:system:r:httpd_t:s0"

![Контекст безопасности веб-сервера Apache](../image/6.png){#fig:006 width=70%}

## Выполнение. Изучение политики и контектса SELinux

Посмотрела статистику по политике. Количество пользователей - 8, ролей - 14, типов - 4934

![Статистика по политике SELinux](../image/8.png){#fig:008 width=70%}


## Выполнение. Изучение политики и контектса SELinux

Определила тип поддиректорий, находящихся в директории /var/www. Тип каталога cgi-bin - httpd_sys_script_exec_t, тип каталога html - httpd_sys_content_t

![Типы поддиректорий в директории /var/www](../image/9.png){#fig:009 width=70%}

## Выполнение. Изучение политики и контектса SELinux

От имени суперпользователя создала файл test.html. Контекст созданного файла - unconfined_u:object_r:httpd_sys_content_t:s0. Так
как по умолчанию пользователи CentOS являются свободными от типа, созданному файлу test.html был сопоставлен пользователь unconfined_u. Роль object_r используется по умолчанию для файлов на «постоянных» носителях и на сетевых файловых системах. Тип httpd_sys_content_t позволяет процессу httpd получить доступ к файлу. Благодаря наличию последнего типа можно получить доступ к файлу
при обращении к нему через браузер

![Контекст файла test.html](../image/11.png){#fig:011 width=70%}


## Выполнение. Изучение политики и контектса SELinux

Обратилась к файлу через веб-сервер, введя в браузере адрес http://127.0.0.1/test.html

![Доступ к файлу test.html через браузер](../image/12.png){#fig:012 width=70%}

## Выполнение. Изучение политики и контектса SELinux

Изменила контекст файла test.html на samba_share_t, к которому процесс httpd не должен иметь доступа. Снова попробовала получить доступ к файлу через браузер, получила сообщение об ошибке. В системном логе появилась информация о необходимости сменить тип файла test.html, чтобы демон httpd мог к нему обращаться

![Сообщение об ошибке после смены конекста](../image/14.png){#fig:014 width=70%}

## Выполнение. Изменение TCP-порта

В соотсветствии с новой политикой, порт 81 входит в список портов по умолчанию, поэтому я изменила порт с 80 на 82 в файле /etc/httpd/conf/httpd.conf. При перезапуске веб-сервера произошел сбой. В файле /var/log/messages появилась запись о запрете доступа через порт 82 и необходимости изменить тип порта. В файле /var/log/audit/audit.log появилась запись о неудачной попытке запуска веб-сервера 

![/var/log/messages](../image/20.png){#fig:020 width=70%}

## Выполнение. Изменение TCP-порта

Добавила порт 82 к списку портов http_port_t. После этого удалось запустить веб-сервер. Вернула контекст httpd_sys_cоntent__t к файлу /var/www/html/ test.html и попробовала получить доступ к файлу через веб-сервер, введя в браузере  http://127.0.0.1:82/test.html

![Доступ к файлу test.html через 82 порт](../image/25.png){#fig:025 width=70%}

## Выводы

- Я развила навыки администрирования ОС Linux. 

- Получила практическое знакомство с технологией SELinux.

- Проверила работу SELinux на практике совместно с веб-сервером Apache.

